<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Atividades - Projeto IntegraCAR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Terra Cota & Creme -->
    <!-- Application Structure Plan: A estrutura da SPA √© um painel de controle com navega√ß√£o por abas. Essa abordagem foi escolhida para transformar o relat√≥rio hier√°rquico (mapa mental) em se√ß√µes tem√°ticas e interativas (Vis√£o Geral, Infraestrutura, Capacita√ß√£o, Fluxo Operacional, TI & Automa√ß√£o). Isso melhora a usabilidade, permitindo que o usu√°rio explore os detalhes de cada pilar do projeto de forma focada, em vez de ler um documento linear. A interatividade √© promovida por meio de gr√°ficos de vis√£o geral e um fluxograma clic√°vel, incentivando a explora√ß√£o ativa dos dados. A se√ß√£o TI & Automa√ß√£o foi aprimorada para incluir um painel Kanban com funcionalidade completa de CRUD (Cria√ß√£o, Leitura, Atualiza√ß√£o, Dele√ß√£o) atrav√©s de um modal din√¢mico. -->
    <!-- Visualization & Content Choices: Relat√≥rio (Mapa Mental) -> Goal: Informar e Organizar -> Viz/Presentation: Painel com abas, Gr√°ficos de Rosca (Chart.js), Listas de Tarefas com √çcones (HTML/CSS), Diagrama de Fluxo (HTML/CSS), Kanban Board (HTML/CSS/JS) com Modal. -> Interaction: Navega√ß√£o entre abas para filtrar conte√∫do, Clicar em etapas do fluxo para ver detalhes, Adicionar/Mudar status/Editar/Remover demandas no Kanban. -> Justification: Gr√°ficos de rosca oferecem uma vis√£o geral r√°pida da distribui√ß√£o de atividades. O Kanban √© o formato mais eficaz para rastrear o progresso e gerenciar detalhes das demandas de TI. O modal mant√©m a interface limpa enquanto oferece funcionalidade avan√ßada. -> Library/Method: Chart.js para gr√°ficos, TailwindCSS e HTML para diagramas e layouts. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fff7ed;
        }
        .tab-active {
            border-color: #c2410c;
            color: #c2410c;
            font-weight: 600;
        }
        .flowchart-step {
            transition: all 0.3s ease;
        }
        .flowchart-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .flowchart-arrow {
            font-size: 2.5rem;
            line-height: 1;
            color: #d1d5db;
            padding: 0 0.5rem;
        }
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .kanban-card:hover {
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Custom class for the responsive chart container height */
        .chart-container {
            position: relative; 
            width: 100%; 
            height: 300px; /* Base height */
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-orange-900">Relat√≥rio Interativo de Atividades</h1>
            <p class="text-lg text-orange-800 mt-1">Projeto IntegraCAR | Setembro & Outubro</p>
        </header>

        <nav class="flex justify-center border-b border-orange-200 mb-8 flex-wrap">
            <button data-tab="overview" class="py-4 px-6 text-sm sm:text-base border-b-2 tab-active">Vis√£o Geral</button>
            <button data-tab="infra" class="py-4 px-6 text-sm sm:text-base border-b-2 border-transparent hover:border-orange-300 transition-colors">Infraestrutura</button>
            <button data-tab="capacitacao" class="py-4 px-6 text-sm sm:text-base border-b-2 border-transparent hover:border-orange-300 transition-colors">Capacita√ß√£o</button>
            <button data-tab="fluxo" class="py-4 px-6 text-sm sm:text-base border-b-2 border-transparent hover:border-orange-300 transition-colors">Fluxo Operacional</button>
            <button data-tab="ti" class="py-4 px-6 text-sm sm:text-base border-b-2 border-transparent hover:border-orange-300 transition-colors">TI & Automa√ß√£o</button>
        </nav>

        <main id="content">
            
            <section id="overview" class="tab-content space-y-8">
                <div>
                    <h2 class="text-2xl font-bold text-orange-900 mb-2">Vis√£o Geral do Per√≠odo</h2>
                    <p class="text-gray-600">Este painel resume as principais frentes de trabalho do projeto nos meses de Setembro e Outubro. A fase inicial concentrou-se na estrutura√ß√£o f√≠sica e capacita√ß√£o da equipe, evoluindo para o desenho de processos e a defini√ß√£o de requisitos tecnol√≥gicos cruciais para a automa√ß√£o das an√°lises do CAR.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center text-center">
                        <span id="total-activities-count" class="text-5xl font-bold text-orange-600">20</span>
                        <p class="text-gray-600 mt-2 font-medium">Atividades Mapeadas</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center text-center">
                        <span class="text-5xl font-bold text-orange-600">4</span>
                        <p class="text-gray-600 mt-2 font-medium">Pilares de Atua√ß√£o</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center text-center">
                        <span class="text-5xl font-bold text-orange-600">2</span>
                        <p class="text-gray-600 mt-2 font-medium">Meses de Atividades</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md md:col-span-2 lg:col-span-3">
                        <h3 class="text-lg font-semibold text-center mb-4 text-orange-900">Distribui√ß√£o de Atividades por Pilar</h3>
                        <div class="chart-container">
                            <canvas id="tasksChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="infra" class="tab-content hidden space-y-6">
                <header>
                    <h2 class="text-2xl font-bold text-orange-900">üèóÔ∏è Infraestrutura e Log√≠stica</h2>
                    <p class="text-gray-600 mt-1">Foco na prepara√ß√£o do ambiente f√≠sico e tecnol√≥gico para garantir a operacionalidade da equipe.</p>
                </header>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-orange-800 mb-4">Reforma e Layout</h3>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Solicita√ß√£o de enquadramento da reforma das salas com Drywall.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Diagrama√ß√£o dos prazos de entrega das reformas.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Vistoria da entrega das reformas conclu√≠das.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-orange-800 mb-4">El√©trica e TI F√≠sica</h3>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Planejamento da el√©trica compatibilizada com o layout, visando circuito nobreak.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Acompanhamento dos servi√ßos de rede para instala√ß√£o dos computadores.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Ajuste para adapta√ß√£o das calhas no corredor, preparando para expans√£o.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="capacitacao" class="tab-content hidden space-y-6">
                <header>
                    <h2 class="text-2xl font-bold text-orange-900">üë• Alinhamento e Capacita√ß√£o</h2>
                    <p class="text-gray-600 mt-1">Atividades voltadas para a forma√ß√£o e integra√ß√£o da equipe do projeto.</p>
                </header>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-orange-800 mb-4">Onboarding da Equipe</h3>
                        <ul class="space-y-3 text-gray-700">
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Sele√ß√£o dos bolsistas do projeto atrav√©s de entrevista, conforme edital.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Curso de capacita√ß√£o para gera√ß√£o de CAR, ministrado pela equipe IDAF e convidados.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-orange-800 mb-4">Alinhamento de Processos</h3>
                        <ul class="space-y-3 text-gray-700">
                             <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Alinhamento com a equipe de TI do Ifes-Cachoeiro sobre ferramentas de aux√≠lio.</li>
                            <li class="flex items-start"><span class="mr-3 text-green-500">‚úîÔ∏è</span>Reuni√£o geral sobre a evolu√ß√£o dos trabalhos e apresenta√ß√£o do fluxo do analista CAR.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="fluxo" class="tab-content hidden space-y-6">
                <header>
                    <h2 class="text-2xl font-bold text-orange-900">‚öôÔ∏è Desenvolvimento do Fluxo Operacional</h2>
                    <p class="text-gray-600 mt-1">Engenharia e formaliza√ß√£o dos processos de trabalho para an√°lise e gest√£o dos cadastros.</p>
                </header>
                <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                    <h3 class="text-lg font-semibold text-orange-800 mb-6 text-center whitespace-nowrap">Etapas do Desenvolvimento do Fluxo (6 Passos)</h3>
                    <div class="flex flex-col md:flex-row items-stretch md:items-center justify-start md:justify-center space-y-4 md:space-y-0 md:space-x-2">
                        
                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">1</div>
                            <h4 class="font-bold text-sm">Estudo de Base</h4>
                            <p class="text-xs text-gray-600 mt-1">Visita ao IDAF para visualizar a organiza√ß√£o e o fluxo operacional existente.</p>
                        </div>
                        <div class="flowchart-arrow self-center hidden md:block">‚Üí</div>
                        
                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">2</div>
                            <h4 class="font-bold text-sm">Design de Processos</h4>
                            <p class="text-xs text-gray-600 mt-1">Desenvolvimento e burocratiza√ß√£o do novo fluxo entre Bolsistas, Orientadores e Consultores.</p>
                        </div>
                        <div class="flowchart-arrow self-center hidden md:block">‚Üí</div>
                        
                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">3</div>
                            <h4 class="font-bold text-sm">Organiza√ß√£o</h4>
                            <p class="text-xs text-gray-600 mt-1">Cria√ß√£o de uma estrutura de pastas para o acompanhamento dos processos.</p>
                        </div>
                        <div class="flowchart-arrow self-center hidden md:block">‚Üí</div>
                        
                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">4</div>
                            <h4 class="font-bold text-sm">An√°lise de Documentos</h4>
                            <p class="text-xs text-gray-600 mt-1">Revis√£o e valida√ß√£o dos documentos digitalizados (eDocs).</p>
                        </div>
                        <div class="flowchart-arrow self-center hidden md:block">‚Üí</div>

                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">5</div>
                            <h4 class="font-bold text-sm">An√°lise de Mapas (CAR)</h4>
                            <p class="text-xs text-gray-600 mt-1">Valida√ß√£o dos limites e classes do CAR com ferramentas de geoprocessamento.</p>
                        </div>
                        <div class="flowchart-arrow self-center hidden md:block">‚Üí</div>
                        
                        <div class="flowchart-step text-center bg-orange-100 p-3 rounded-lg border border-orange-200 w-full md:flex-1 shrink-0 h-full">
                            <div class="text-lg mb-1 font-semibold">6</div>
                            <h4 class="font-bold text-sm">Finaliza√ß√£o do Processo</h4>
                            <p class="text-xs text-gray-600 mt-1">Elabora√ß√£o de of√≠cio de encerramento e envio para o SIMLAM/eDocs.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="ti" class="tab-content hidden space-y-6">
                 <header>
                    <h2 class="text-2xl font-bold text-orange-900">üíª TI e Automa√ß√£o</h2>
                    <p class="text-gray-600 mt-1">Painel Kanban para gerenciar demandas e alinhamentos para otimizar as tarefas operacionais. Clique em um cart√£o para visualizar detalhes, editar ou remover.</p>
                </header>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-orange-800 mb-4">Adicionar Nova Demanda de Automa√ß√£o</h3>
                    <form id="add-demand-form" class="flex flex-col gap-2">
                        <input type="text" id="new-demand-title" placeholder="T√≠tulo da Demanda (Ex: API de eDocs)" class="flex-grow p-2 border border-orange-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" required>
                        <div class="flex flex-col sm:flex-row gap-2">
                             <input type="text" id="new-demand-responsible" placeholder="Respons√°vel (Nome)" class="p-2 border border-orange-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 w-full sm:w-1/2">
                             <input type="text" id="new-demand-description" placeholder="Descri√ß√£o breve ou completa da demanda" class="p-2 border border-orange-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 w-full sm:w-1/2" required>
                        </div>
                        <button type="submit" class="bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">Adicionar Demanda</button>
                    </form>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-orange-900 mb-4">Acompanhamento de Demandas (Kanban)</h3>
                    <div id="ti-demands-board" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        
                        <div id="col-Demanda" class="bg-gray-100 p-3 rounded-lg">
                            <h4 class="font-bold text-lg text-red-700 mb-3">üìã Demanda (<span data-count="Demanda">0</span>)</h4>
                            <div class="cards-wrapper space-y-3 min-h-[50px]">
                                <!-- Cart√µes gerados via JavaScript -->
                            </div>
                        </div>
                        
                        <div id="col-Em Execu√ß√£o" class="bg-gray-100 p-3 rounded-lg">
                            <h4 class="font-bold text-lg text-yellow-700 mb-3">üõ†Ô∏è Em Execu√ß√£o (<span data-count="Em Execu√ß√£o">0</span>)</h4>
                             <div class="cards-wrapper space-y-3 min-h-[50px]">
                                <!-- Cart√µes gerados via JavaScript -->
                            </div>
                        </div>
                        
                        <div id="col-Conclu√≠da" class="bg-gray-100 p-3 rounded-lg">
                            <h4 class="font-bold text-lg text-green-700 mb-3">‚úÖ Conclu√≠da (<span data-count="Conclu√≠da">0</span>)</h4>
                            <div class="cards-wrapper space-y-3 min-h-[50px]">
                                <!-- Cart√µes gerados via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-orange-800 mb-4">Alinhamento e Integra√ß√µes (Foco)</h3>
                    <ul class="space-y-3 text-gray-700 list-disc list-inside">
                        <li>Identifica√ß√£o do contato respons√°vel pelas APIs do eDocs e direcionamento para a TI do Ifes-Cachoeiro.</li>
                        <li>Alinhamento cont√≠nuo com a TI sobre atividades manuais e o roadmap de automa√ß√£o.</li>
                        <li>Cria√ß√£o de diagrama com o fluxo operacional e as atividades da TI.</li>
                    </ul>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal de Detalhes/Edi√ß√£o -->
    <div id="demand-modal" class="modal fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 invisible opacity-0">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 transform transition-all duration-300 scale-95">
            <h3 class="text-xl font-bold text-orange-900 mb-4" id="modal-title-display">Detalhes da Demanda</h3>
            <form id="edit-demand-form" class="space-y-4">
                <input type="hidden" id="modal-demand-id">
                
                <div>
                    <label for="modal-title" class="block text-sm font-medium text-gray-700">T√≠tulo</label>
                    <input type="text" id="modal-title" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" required>
                </div>

                <div>
                    <label for="modal-description" class="block text-sm font-medium text-gray-700">Descri√ß√£o</label>
                    <textarea id="modal-description" rows="3" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" required></textarea>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="modal-responsible" class="block text-sm font-medium text-gray-700">Respons√°vel</label>
                        <input type="text" id="modal-responsible" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    </div>
                    <div>
                        <label for="modal-status" class="block text-sm font-medium text-gray-700">Status</label>
                        <select id="modal-status" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                            <option value="Demanda">Demanda</option>
                            <option value="Em Execu√ß√£o">Em Execu√ß√£o</option>
                            <option value="Conclu√≠da">Conclu√≠da</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-between pt-4 border-t border-gray-100">
                    <button type="button" id="delete-demand-button" class="bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">Remover</button>
                    <div class="space-x-2">
                        <button type="button" id="close-modal-button" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">Fechar</button>
                        <button type="submit" class="bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">Salvar Altera√ß√µes</button>
                    </div>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DADOS INICIAIS
            const initialTIDemands = [
                { id: 1, title: "Buscar APPs para Pagina√ß√£o", desc: "Achar e testar APPs para paginar e eliminar p√°ginas vazias de documentos digitalizados. Necess√°rio pesquisa de mercado e avalia√ß√£o de custo-benef√≠cio.", status: "Em Execu√ß√£o", responsible: "Jo√£o P." },
                { id: 2, title: "Of√≠cio de Encerramento Autom√°tico", desc: "Confec√ß√£o autom√°tica de of√≠cio de encerramento a partir de documentos digitalizados. Requer integra√ß√£o com sistema de template de documentos e autentica√ß√£o.", status: "Demanda", responsible: "TI Ifes" },
                { id: 3, title: "Gera√ß√£o de Planilha Autom√°tica", desc: "Gerar planilha autom√°tica com colunas (Documento, Nome, N√∫mero) a partir de arquivos digitalizados. Prioridade m√©dia para otimiza√ß√£o da confer√™ncia inicial.", status: "Em Execu√ß√£o", responsible: "Maria C." },
                { id: 4, title: "Relat√≥rio de An√°lise via API", desc: "Gerar an√°lise documental via API, criando um relat√≥rio que vincula o resultado da an√°lise com o SIMLAM e aponta o caminho para a atua√ß√£o do analista. Demanda de alta complexidade e impacto.", status: "Demanda", responsible: "TI Ifes" }
            ];
            let tiDemands = [...initialTIDemands];
            let nextId = 5;

            // Dados fixos para o gr√°fico (TI ser√° din√¢mico)
            const chartData = {
                infra: 6,
                capacitacao: 4,
                fluxo: 6, 
                ti: tiDemands.length
            };
            let tasksChartInstance = null;
            
            // Refer√™ncias do Modal
            const modal = document.getElementById('demand-modal');
            const editForm = document.getElementById('edit-demand-form');
            const closeModalButton = document.getElementById('close-modal-button');
            const deleteDemandButton = document.getElementById('delete-demand-button');

            // FUN√á√ïES GERAIS
            function updateDashboard() {
                chartData.ti = tiDemands.length; // Atualiza o total de demandas de TI
                const totalActivities = chartData.infra + chartData.capacitacao + chartData.fluxo + chartData.ti;
                document.getElementById('total-activities-count').textContent = totalActivities;

                if (tasksChartInstance) {
                    tasksChartInstance.data.datasets[0].data = Object.values(chartData);
                    tasksChartInstance.update();
                }
            }
            
            // FUN√á√ïES KANBAN E RENDERIZA√á√ÉO
            function renderTIDemands() {
                const boardColumns = {
                    "Demanda": document.getElementById('col-Demanda').querySelector('.cards-wrapper'),
                    "Em Execu√ß√£o": document.getElementById('col-Em Execu√ß√£o').querySelector('.cards-wrapper'),
                    "Conclu√≠da": document.getElementById('col-Conclu√≠da').querySelector('.cards-wrapper')
                };

                // Limpar cart√µes e resetar contadores
                let demandCounts = { "Demanda": 0, "Em Execu√ß√£o": 0, "Conclu√≠da": 0 };
                Object.values(boardColumns).forEach(col => { col.innerHTML = ''; });

                tiDemands.forEach(demand => {
                    const descPreview = demand.desc.substring(0, 90) + (demand.desc.length > 90 ? '...' : '');
                    
                    const itemHtml = `
                        <div data-id="${demand.id}" class="kanban-card bg-white p-3 rounded-lg shadow-sm border border-orange-200 cursor-pointer transition-shadow duration-150">
                            <h5 class="font-bold text-sm text-orange-900">${demand.title}</h5>
                            <p class="text-xs text-gray-500 mt-1 mb-2">${descPreview}</p>
                            <p class="text-xs font-medium text-gray-700">Resp: <span class="font-semibold">${demand.responsible || 'N√£o Definido'}</span></p>
                        </div>`;
                    
                    const colWrapper = boardColumns[demand.status];
                    if (colWrapper) {
                         colWrapper.insertAdjacentHTML('beforeend', itemHtml);
                         demandCounts[demand.status]++;
                    }
                });
                
                // Atualizar contadores
                Object.keys(demandCounts).forEach(status => {
                    const countEl = document.querySelector(`#col-${status} [data-count]`);
                    if (countEl) countEl.textContent = demandCounts[status];
                });

                // Adicionar listeners para abrir o modal
                document.querySelectorAll('.kanban-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const id = parseInt(card.getAttribute('data-id'));
                        openDemandModal(id);
                    });
                });
            }

            // FUN√á√ïES DO MODAL
            function openDemandModal(id) {
                const demand = tiDemands.find(d => d.id === id);
                if (!demand) return;

                document.getElementById('modal-demand-id').value = demand.id;
                document.getElementById('modal-title').value = demand.title;
                document.getElementById('modal-description').value = demand.desc;
                document.getElementById('modal-responsible').value = demand.responsible;
                document.getElementById('modal-status').value = demand.status;
                document.getElementById('modal-title-display').textContent = demand.title;

                modal.classList.remove('invisible', 'opacity-0');
                modal.classList.add('visible', 'opacity-100');
            }

            function closeDemandModal() {
                modal.classList.remove('visible', 'opacity-100');
                modal.classList.add('invisible', 'opacity-0');
            }

            // EVENTOS DO MODAL
            closeModalButton.addEventListener('click', closeDemandModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeDemandModal(); // Fecha ao clicar fora
            });

            editForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const id = parseInt(document.getElementById('modal-demand-id').value);
                const demandIndex = tiDemands.findIndex(d => d.id === id);

                if (demandIndex > -1) {
                    tiDemands[demandIndex].title = document.getElementById('modal-title').value.trim();
                    tiDemands[demandIndex].desc = document.getElementById('modal-description').value.trim();
                    tiDemands[demandIndex].responsible = document.getElementById('modal-responsible').value.trim();
                    tiDemands[demandIndex].status = document.getElementById('modal-status').value;
                    
                    renderTIDemands();
                    updateDashboard();
                    closeDemandModal();
                }
            });

            deleteDemandButton.addEventListener('click', function() {
                const id = parseInt(document.getElementById('modal-demand-id').value);
                // N√£o usamos alert/confirm. Vamos simular a remo√ß√£o direta para manter a conformidade.
                tiDemands = tiDemands.filter(d => d.id !== id);
                
                renderTIDemands();
                updateDashboard();
                closeDemandModal();
            });

            // L√ìGICA DAS ABAS
            const tabs = document.querySelectorAll('nav button');
            const contents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-tab');
                    tabs.forEach(t => t.classList.remove('tab-active'));
                    tab.classList.add('tab-active');
                    contents.forEach(content => {
                        content.id === target ? content.classList.remove('hidden') : content.classList.add('hidden');
                    });
                });
            });

            // INICIALIZA√á√ÉO DO GR√ÅFICO
            const taskChartData = {
                labels: ['Infraestrutura', 'Capacita√ß√£o', 'Fluxo Operacional', 'TI & Automa√ß√£o'],
                datasets: [{
                    label: 'Atividades por Pilar',
                    data: Object.values(chartData),
                    backgroundColor: ['#fb923c', '#f97316', '#ea580c', '#c2410c'],
                    borderColor: '#fff7ed',
                    borderWidth: 3,
                    hoverOffset: 4
                }]
            };
            tasksChartInstance = new Chart(document.getElementById('tasksChart'), {
                type: 'doughnut',
                data: taskChartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { padding: 20, font: { family: "'Inter', sans-serif" } } } },
                    cutout: '60%'
                }
            });
            
            // L√ìGICA DO FORMUL√ÅRIO DE ADI√á√ÉO
            document.getElementById('add-demand-form').addEventListener('submit', function (e) {
                e.preventDefault();
                const titleInput = document.getElementById('new-demand-title');
                const responsibleInput = document.getElementById('new-demand-responsible');
                const descriptionInput = document.getElementById('new-demand-description');
                
                const newTitle = titleInput.value.trim();
                const newResponsible = responsibleInput.value.trim() || 'Aguardando Defini√ß√£o';
                const newDescription = descriptionInput.value.trim();

                if (newTitle && newDescription) {
                    tiDemands.push({ 
                        id: nextId++,
                        title: newTitle, 
                        desc: newDescription, 
                        status: "Demanda", // Inicia sempre no status "Demanda"
                        responsible: newResponsible
                    });
                    
                    titleInput.value = '';
                    responsibleInput.value = '';
                    descriptionInput.value = '';
                    
                    renderTIDemands();
                    updateDashboard();
                }
            });
            
            // RENDERIZA√á√ÉO INICIAL
            updateDashboard();
            renderTIDemands();
        });
    </script>
</body>
</html>
